<!DOCTYPE html>
<!--
	Demonstration of the TI SensorTag JavaScript library.
-->
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=yes, initial-scale=1.0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="expires" content="-1" />
	<title>Gen 2 Teacher APP</title>

	<style> 
		@import 'ui/css/evothings-app.css';
		@import 'ui/css/nerld.css';
		@import 'ui/css/jquery.mobile-1.4.5.min.css';
	</style>

	<script>
	//<link rel="stylesheet" href="https://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	</script>
	
	<script>
	// Redirect console.log to Evothings Workbench.
		if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>

	<script src="cordova.js"></script>
	<script src="libs/evothings/evothings.js"></script>
	<script src="libs/evothings/ui/ui.js"></script>
	<script src="libs/evothings/easyble/easyble.js"></script>
	<script src="https://www.google.com/jsapi"></script>
   	<script src="libs/evothings/tisensortag/tisensortag-nerld.js"></script>
	<script src="TeacherApp.js"></script>
	<script src="TeacherSensorTagConnectionApp.js"></script>
	<script src="libs/jquery/jquery-1.11.3.min.js"></script>
	<script src="libs/jquery/jquery.mobile-1.4.5.min.js"></script>
	<script src="libs/jquery/jquery.serializejson.min.js"></script>
 
	
</head> 
<body onload="onLoad()"> 
    <script>
		var httpd = null;

		function onLoad() {
			document.addEventListener("deviceready", onDeviceReady, false);
		}
		
		function inputFocus(i){
			if(i.value==i.defaultValue){ i.value=""; i.style.color="#000"; }
		}
		function inputBlur(i){
			if(i.value==""){ i.value=i.defaultValue; i.style.color="#888"; }
		}


	</script>
	

	<div data-role="page" id="pageHome">
        <div data-theme="a" data-role="header" data-add-back-btn="true">
			<h1> Welcome to Teacher App </h1> 
			<a href="#pageServerDetails" data-icon="gear" class="ui-btn-right">Server Details</a>
		</div>        
	
		<div role="main" class="ui-content">
			<h1>Welcome to the Teacher App.</h1>
			Here you can configure your SensorTags and design a new experiment for your students
			<a href="#pageExperiment" data-role="button">Design an Experiment</a>
			<a href="#pageSensortagConfig" data-role="button">Sensor Tag Configuration</a>
			<a href="#pageShareFiles" data-role="button">Share Your Files</a>
		</div>
	</div>
	  
	<div data-role="page" id="pageExperiment">
        <div data-theme="a" data-role="header" data-add-back-btn="true">
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-left">Home</a>
			<a href="#pageSettings" data-icon="gear" class="ui-btn-right">Settings</a>
			<h1> Experiment Design </h1> 
		</div>        

		<div data-role="main" class="ui-content">
			<form id="experimentForm">
				<label for="name"><strong>Provide an Experiment Title:</strong></label>
				<input type="text" name="labTitle" id="labTitle" value="SensorTag Experiment"  onfocus="inputFocus(this)" onblur="inputBlur(this)"/>
				<div data-role="fieldcontain"><label for="addDataStorage">Allow Data Storage</label><input type="checkbox" data-role="flipswitch" name="dataStorageAllowed" id="dataStorageAllowed" onchange="showHideLabel('dataStoragePrefixLabel')" ></div>
				<div data-role="fieldcontain" id="dataStoragePrefixLabel" + id + "label" style="display:none"><label for="dataStoragePrefix"> Prefix for Data Storage File:</label><input type="text" name="dataStoragePrefix" value="" placeholder="sensorTag"/></div>

				<div data-role="collapsible" data-theme="c" data-content-theme="c" name="sensorTags[0][connect]"  style="display:block;">
					<h1>First SensorTag Configuration</h1> 
					<div id="sensortag0List">
					<script> buildSensortagConfigHTML(0) </script>
					</div>
				</div>

				<div data-role="collapsible" data-theme="c" data-content-theme="c" name="sensorTags[1][connect]"  style="display:block;">
					<h1>Second SensorTag Configuration</h1> 
					<div id="sensortag1List">
					<script> buildSensortagConfigHTML(1) </script>
					</div>
				</div>

				<a href="#pageHome" data-inline="true" data-icon="delete" data-theme="a" data-role="button">Cancel</a>
				<input type="button" data-inline="true" data-icon="check" data-theme="b" name="submit" id="submit" value="Submit" onclick="getConfigFileName('json')" />
				<input type="reset" data-inline="true" data-icon="arrow-r" data-theme="a" data-role="button" id="newExperiment" value="New Experiment" />

			</form>
		
		</div>
	</div>
	
	<div id="pageSensortagConfig" data-role="page" >
		<div data-theme="a" data-role="header" data-add-back-btn="true">
			<h1>SensorTag Configuration</h1>
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-right">Home</a>
		</div>
		<div data-role="content">
			<div data-role="content" data-theme="b">
			Use this page to configure your SensorTags to have names associated with unique ID's. <br />
			You can also set the configuration institution and owner on the file<br />
			</div>
			<div  data-role="collapsible" data-content-theme="c">
			   <h3>Current Configuration File</h3>  
				<p id='sensortagConfigFileData'>
				</p>
				<a onclick="viewSensorTagConfigFile()" data-role="button" data-mini="true"> Load latest file </a>
			</div> 
 
			<a href="#pageConfigData" data-role="button"  data-index="new"> Change Institution or Owner </a>
			<a href="#pageAddSensortags" data-role="button" > Add or Update SensorTag names</a>
			<a id="overwriteSensortagConfigFile" href="#newConfigData" data-role="button" > Create new Sensortag configuration</a>
	
		</div>
	</div>

	<div id="pageConfigData" data-role="page" >
		<div data-role="header" data-add-back-btn="true">
			<h1>Update SensorTag Configuration</h1>
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-right">Home</a>
		</div>
		<div data-role="content">
			<div data-role="content" data-theme="b">
				Enter new Institution or Owner names below. <br />
				To keep existing values, leave the field blank.
			</div>

			<form id="sensorTagConfigForm" >
				<label for="institution"><strong>New Institution Name:</strong></label>
				<input type="text" name="institution" id="institution" value=""  onfocus="inputFocus(this)" onblur="inputBlur(this)"/>

				<label for="owner"><strong>New Owner Name:</strong></label>
				<input type="text" name="owner" id="owner" value=""  onfocus="inputFocus(this)" onblur="inputBlur(this)"/>

				<a href="#pageSensortagConfig" data-inline="true" data-icon="delete" data-theme="a" data-role="button" >Cancel</a>
				<input type="button" data-inline="true" data-icon="check" data-theme="b" name="submit" id="institutionOwnerUpdateSubmit" value="Update" onclick="	updateInstitutionOwner()">
			</form>
		</div>
	</div>

	<div id="newConfigData" data-role="page" >
		<div data-role="header" data-add-back-btn="true">
			<h1>Update SensorTag Configuration</h1>
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-right">Home</a>
		</div>
		<div data-role="content">
			<div data-role="content" data-theme="b">
				Enter new Institution or Owner names below. <br />
			</div>

			<form id="newSensorTagConfigForm" >
				<label for="institution"><strong>New Institution Name:</strong></label>
				<input type="text" name="institution" id="institution" value=""  onfocus="inputFocus(this)" onblur="inputBlur(this)"/>

				<label for="owner"><strong>New Owner Name:</strong></label>
				<input type="text" name="owner" id="owner" value=""  onfocus="inputFocus(this)" onblur="inputBlur(this)"/>

				<a href="#pageSensortagConfig" data-inline="true" data-icon="delete" data-theme="a" data-role="button" >Cancel</a>
				<input type="button" data-inline="true" data-icon="check" data-theme="b" name="submit" id="institutionOwnerUpdateSubmit" value="Update" onclick="	newSensorTagConfigFile()">
			</form>
		</div>
	</div>
	
	<div id="pageAddSensortags" data-role="page" >
		<div data-role="header" data-add-back-btn="true">
			<h1>Add SensorTags to Config</h1>
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-right">Home</a>
		</div>
		<div data-role="content">
			<div id="sensortagScanning" >
			<div data-role="content" data-theme="b">
				To add SensorTags to the configuration file: <br />
				1. Start scanning for available SensorTags. <br />
				2. Select the SensorTag to connect to. <br />
				3. Press any key on the SensorTag to create or update the SensorTag name.
			</div>

			<button id="startScanButton" onclick="app.ui.onStartScanButton()" class="green" style="display:block" data-inline="true">
				START SCANNING FOR SENSORTAGS
			</button>

			<button id="pauseScanButton" onclick="app.ui.onPauseScanButton()" class="charcoal" style="display:none" data-inline="true">
				PAUSE SCANNNING
			</button>

			<p><strong>Scan Status: </strong><span id="scan-status">Scanning Paused</span></p>
			<p><strong>SensorTag Connection Status: </strong> <span id="StatusData">Press "Start Ssanning For SensorTags" to look for SensorTags</span></p>
			<div id="deviceInfo" style="display:none">
				<p><strong> <span id="KeypressData">Press any key to on the SensorTag to add it to the configuration file</strong> </span> </p>
				<p>
					SensorTag device model: <span id="DeviceModel">?</span><br />
					Firmware version: <span id="FirmwareData">?</span><br />
					SensorTag SystemID: <span id="SystemID">?</span><br />
				</p>
			</div>
			<div data-inset="true" id="found-devices" class="dynamic"></div>
			</div>
		</div>
	</div>

	<div data-role="page" id="pageShareFiles">
		<div data-role="header" data-add-back-btn="true">
			<h1> Sharing Configuration Files </h1> 
			<a href="index.html" class="ui-btn ui-icon-home ui-btn-icon-right">Home</a>
		</div>
		
		<div data-role="main" class="ui-content">
			<h1>Select the file to share</h1>
			<div> 
			 Selecting a file allows you to email the selected file.  
			</div>
			
			<div  data-role="collapsible" data-content-theme="c">
			   <h3>Choose a data file to share</h3>
				<ul id="configFileList" data-role="listview" data-inset="true">
				</ul>
				<a data-role="button" onclick="listConfigFiles('configFileList')">Update Configuration File List</a>
			</div> 

 		</div>  
	</div> 


	<div id="pageServerDetails" data-role="page" >
		<div data-role="header" data-add-back-btn="true"><h1>Settings</h1>
			<a href="index.html" data-icon="home" class="ui-btn-right">Home</a>
		</div>
		<div data-role="content">
			<script> //updateStatus() </script>

			<h1>Local Server Details</h1>
			<div id='url'>Address </div>
			<div id='localpath'></div>
			<div id='location'></div>
		</div>
	</div>

</body>
</html>


